<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<link rel="shortcut icon" href="https://wakaruwakaru.github.io/game-sites/index/icon/icon1.png" />
<title>スネークゲーム</title>
<style>
  body {
    background:#111;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    height:100vh;
    margin:0;
    color:white;
    font-family:Arial, sans-serif;
  }
  canvas {
    background:#222;
    box-shadow:0 0 20px #0f0;
    touch-action:none;
  }
  #score {
    margin-top:10px;
    font-size:20px;
  }
  #speedBox {
    margin-bottom:15px;
    font-size:16px;
  }
  /* スマホ操作ボタン */
  .controls {
    margin-top:20px;
    display:grid;
    grid-template-columns:60px 60px 60px;
    gap:10px;
    justify-content:center;
  }
  .btn {
    width:60px;
    height:60px;
    background:#333;
    border-radius:10px;
    display:flex;
    justify-content:center;
    align-items:center;
    font-size:24px;
    border:2px solid #0f0;
    user-select:none;
  }
  .btn:active {
    background:#0f0;
    color:black;
  }

/* フローティングボタンの共通デザイン */
.floating-btn{
    position: fixed;
    right: 20px;
    bottom: 20px;
    width: 58px;
    height: 58px;
    border-radius: 50%;
    background: #111;
    border: 2px solid #4da6ff;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 26px;
    color: #bcdfff;
    cursor: pointer;
    transition: 0.25s;
    box-shadow: 0 0 10px #3d8cff88;
}
/* ホバー時に光る */
.floating-btn:hover{
    background: #4da6ff33;
    box-shadow: 0 0 16px #4da6ffcc;
}
/* クリック時に縮む */
.floating-btn:active{
    transform: scale(0.9);
}
/* ボタン位置調整 */
#reloadBtn{
    bottom: 90px; /* logout の上に配置 */
}
#logoutBtn{
    bottom: 20px;
}
</style>
</head>
<body>

<div id="speedBox">
  Speed: <input id="speed" type="range" min="50" max="300" value="120"> <span id="speedVal">120ms</span>
</div>

<canvas id="game" width="300" height="300"></canvas>
<div id="score">Score: 0</div>

<div class="controls">
  <div></div>
  <div class="btn" data-dir="up">▲</div>
  <div></div>

  <div class="btn" data-dir="left">◀</div>
  <div></div>
  <div class="btn" data-dir="right">▶</div>

  <div></div>
  <div class="btn" data-dir="down">▼</div>
  <div></div>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const grid = 15;

let snake, apple, vx, vy, score;
let interval;
let speed = 120;

// 初期化
function resetGame() {
  snake = [{x:150, y:150}];
  apple = randApple();
  vx = grid;
  vy = 0;
  score = 0;
  document.getElementById("score").textContent = "Score: 0";
  
  if (interval) clearInterval(interval);
  interval = setInterval(loop, speed);
}

function randApple() {
  return {
    x: Math.floor(Math.random() * (canvas.width / grid)) * grid,
    y: Math.floor(Math.random() * (canvas.height / grid)) * grid
  };
}

function gameOver() {
  ctx.fillStyle = "rgba(0,0,0,0.7)";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  ctx.fillStyle = "#f00";
  ctx.font = "30px Arial";
  ctx.fillText("GAME OVER", 50, 150);

  setTimeout(resetGame, 1500);
}

function loop() {
  const head = {x: snake[0].x + vx, y: snake[0].y + vy};

  // 壁衝突 → ゲームオーバー
  if (head.x < 0 || head.x >= canvas.width ||
      head.y < 0 || head.y >= canvas.height) {
    gameOver();
    return;
  }

  // 自分にぶつかった？
  if (snake.some(p => p.x === head.x && p.y === head.y)) {
    gameOver();
    return;
  }

  snake.unshift(head);

  // りんごを食べた？
  if (head.x === apple.x && head.y === apple.y) {
    apple = randApple();
    score++;
    document.getElementById("score").textContent = "Score: " + score;
  } else {
    snake.pop();
  }

  // 描画
  ctx.fillStyle = "#222";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // スネーク
  ctx.fillStyle = "#0f0";
  snake.forEach(p => ctx.fillRect(p.x,p.y,grid-1,grid-1));

  // りんご
  ctx.fillStyle = "red";
  ctx.fillRect(apple.x, apple.y, grid-1, grid-1);
}

// スピード調整
document.getElementById("speed").addEventListener("input", e=>{
  speed = Number(e.target.value);
  document.getElementById("speedVal").textContent = speed + "ms";
  clearInterval(interval);
  interval = setInterval(loop, speed);
});

// キーボード操作
document.addEventListener("keydown", e => {
  if (e.key === "ArrowUp" && vy === 0) {vx=0;vy=-grid;}
  if (e.key === "ArrowDown" && vy === 0) {vx=0;vy=grid;}
  if (e.key === "ArrowLeft" && vx === 0) {vx=-grid;vy=0;}
  if (e.key === "ArrowRight" && vx === 0) {vx=grid;vy=0;}
});

// スマホボタン
document.querySelectorAll(".btn").forEach(btn=>{
  btn.addEventListener("click", ()=>{
    const dir = btn.dataset.dir;
    if (dir==="up" && vy===0) {vx=0;vy=-grid;}
    if (dir==="down" && vy===0) {vx=0;vy=grid;}
    if (dir==="left" && vx===0) {vx=-grid;vy=0;}
    if (dir==="right" && vx===0) {vx=grid;vy=0;}
  });
});

// ゲーム開始
resetGame();
</script>
<div id="reloadBtn" class="floating-btn" onclick="reload()">↻</div>
<div id="logoutBtn" class="floating-btn" onclick="backPage()">⇦</div>
</body>
    <script>
        const urlParams = new URLSearchParams(location.search);
        const token1 = urlParams.get("key1");
        localStorage.setItem("requestPage1", "");
        const token3 = localStorage.getItem("account1");
        localStorage.setItem("account1", "");
        if((token1 !== localStorage.getItem("key1")) || (token3 == "") || (token3 == null)){
            localStorage.setItem("key1", "unauthorized");
            location.href = "https://wakaruwakaru.github.io/game-sites/";
        }else{
            localStorage.setItem("key1", "");
        }

        function reload(){
            const key1 = crypto.randomUUID();
            localStorage.setItem("key1", key1);
            localStorage.setItem("account1", token3);
            location.href = "https://wakaruwakaru.github.io/game-sites/top0010?key1=" + key1;
        }
        function backPage(){
            const key1 = crypto.randomUUID();
            localStorage.setItem("key1", key1);
            localStorage.setItem("account1", token3);
            location.href = "https://wakaruwakaru.github.io/game-sites/top0001?key1=" + key1;
        }
    </script>
</html>
