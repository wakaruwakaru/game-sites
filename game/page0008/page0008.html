<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>„Å¥„Å£„Åü„Åó</title>
<link rel="shortcut icon" href="/game-sites/index/icon/icon1.png" >
<link rel="stylesheet" href="./css/main.css">
</head>
<body>

<div class="container">
    <h1>üé∞ „Å¥„Å£„Åü„Åó</h1>
    <div class="slot-container">
        <div>
            <div id="slot1" class="slot">7</div>
            <button id="stopButton1">STOP</button>
        </div>
        <div>
            <div id="slot2" class="slot">7</div>
            <button id="stopButton2">STOP</button>
        </div>
        <div>
            <div id="slot3" class="slot">7</div>
            <button id="stopButton3">STOP</button>
        </div>
    </div>

    <button id="startButton">START</button>
    <p id="result"></p>
</div>

<script src="./js/main.js"></script>
<div id="reloadBtn" class="floating-btn" onclick="reload()">‚Üª</div>
<div id="logoutBtn" class="floating-btn" onclick="backPage()">‚á¶</div>
<script>
    const urlParams = new URLSearchParams(location.search);
    const token1 = urlParams.get("key1");
    const token3 = localStorage.getItem("account1");
    localStorage.setItem("account1", "");
    if((token1 !== localStorage.getItem("key1")) || (token3 == "") || (token3 == null)){
        localStorage.setItem("key1", "unauthorized");
        localStorage.setItem("requestPage1", "game/page0008/page0008");
        location.href = "/game-sites/";
    }else{
        localStorage.setItem("key1", "");
        localStorage.setItem("requestPage1", "");
        setInterval(() => {
            sendToGAS(token3, "", "page");
        }, 5000);
    }

    /* ======== Google Apps Script Web App URL ======== */
    const WEB_APP_URL =
      "https://script.google.com/macros/s/AKfycbxzyrgvalRn0lOL0jF-OL39xFCn_1tga9l1TVt283uKUftgx7E4nPn4zpvwOBRObpiMLA/exec";
    /* ======== GAS„Å´ÈÄÅ‰ø°„Åô„ÇãÂá¶ÁêÜ ======== */
    async function sendToGAS(User, text, status){
      const payload = {
        user: User,
        message: text,
        status
      };
      try {
        await fetch(WEB_APP_URL, {
          method: "POST",
          mode: "no-cors",   // ‚Üê GAS „Åå CORS Ë®±ÂèØ„Åó„Å¶„Å™„ÅÑ„Åü„ÇÅÂøÖË¶Å
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });
      } catch (e) {
        console.error("ÈÄÅ‰ø°„Ç®„É©„Éº:", e);
      }
    }

    function reload(){
        const key1 = crypto.randomUUID();
        localStorage.setItem("key1", key1);
        localStorage.setItem("account1", token3);
        location.href = "/game-sites/game/page0008/page0008?key1=" + key1;
    }
    function backPage(){
        const key1 = crypto.randomUUID();
        localStorage.setItem("key1", key1);
        localStorage.setItem("account1", token3);
        location.href = "/game-sites/top/top0001/top0001?key1=" + key1;
    }
  </script>
</body>
</html>
