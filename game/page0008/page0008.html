<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>„Å¥„Å£„Åü„Åó</title>
<link rel="shortcut icon" href="/game-sites/index/icon/icon1.png" >
<link rel="stylesheet" href="./css/main.css">
</head>
<body>

<div class="container">
    <h1>üé∞ „Å¥„Å£„Åü„Åó</h1>

    <div class="slot-container">
        <div>
            <div id="slot1" class="slot">7</div>
            <button id="stopButton1">STOP</button>
        </div>
        <div>
            <div id="slot2" class="slot">7</div>
            <button id="stopButton2">STOP</button>
        </div>
        <div>
            <div id="slot3" class="slot">7</div>
            <button id="stopButton3">STOP</button>
        </div>
    </div>

    <button id="startButton">START</button>
    <p id="result"></p>
</div>

<script>
const slots = [
    document.getElementById("slot1"),
    document.getElementById("slot2"),
    document.getElementById("slot3")
];

const symbols = ["üçé", "üçå", "üçá", "üçí", "üçä", "7"];
let slotTimers = [];
let isSpinning = [false, false, false];

/* ====== „Çπ„Çø„Éº„Éà ====== */
function startSlot() {
    document.getElementById("result").textContent = "";

    slots.forEach(slot => {
        slot.classList.remove("win");
    });

    for (let i = 0; i < slots.length; i++) {
        if (!isSpinning[i]) {
            isSpinning[i] = true;
            slotTimers[i] = setInterval(() => {
                slots[i].textContent = symbols[Math.floor(Math.random() * symbols.length)];
            }, 100);
        }
    }
}

/* ====== „Çπ„Éà„ÉÉ„Éó ====== */
function stopSlot(reelIndex) {
    if (isSpinning[reelIndex]) {
        clearInterval(slotTimers[reelIndex]);
        isSpinning[reelIndex] = false;

        /* ÂÅúÊ≠¢„Ç®„Éï„Çß„ÇØ„Éà */
        slots[reelIndex].classList.add("flash");
        setTimeout(() => slots[reelIndex].classList.remove("flash"), 350);
    }

    if (!isSpinning.includes(true)) {
        checkResult();
    }
}

/* ====== ÁµêÊûúÂà§ÂÆö ====== */
function checkResult() {
    const result = slots.map(s => s.textContent);

    if (result[0] === result[1] && result[1] === result[2]) {
        document.getElementById("result").textContent = "‚ú® Â§ßÂΩì„Åü„ÇäÔºÅ ‚ú®";

        /* Â§ßÂΩì„Åü„Çä„Ç®„Éï„Çß„ÇØ„Éà */
        slots.forEach(s => s.classList.add("win"));

    } else {
        document.getElementById("result").textContent = "ÊÆãÂøµ‚Ä¶";
    }
}

document.getElementById("startButton").addEventListener("click", startSlot);
document.getElementById("stopButton1").addEventListener("click", () => stopSlot(0));
document.getElementById("stopButton2").addEventListener("click", () => stopSlot(1));
document.getElementById("stopButton3").addEventListener("click", () => stopSlot(2));
</script>
<div id="reloadBtn" class="floating-btn" onclick="reload()">‚Üª</div>
<div id="logoutBtn" class="floating-btn" onclick="backPage()">‚á¶</div>
</body>
<script>
    const urlParams = new URLSearchParams(location.search);
    const token1 = urlParams.get("key1");
    const token3 = localStorage.getItem("account1");
    localStorage.setItem("account1", "");
    if((token1 !== localStorage.getItem("key1")) || (token3 == "") || (token3 == null)){
        localStorage.setItem("key1", "unauthorized");
        localStorage.setItem("requestPage1", "game/page0008/page0008");
        location.href = "/game-sites/";
    }else{
        localStorage.setItem("key1", "");
        localStorage.setItem("requestPage1", "");
    }
    function reload(){
        const key1 = crypto.randomUUID();
        localStorage.setItem("key1", key1);
        localStorage.setItem("account1", token3);
        location.href = "/game-sites/game/page0008/page0008?key1=" + key1;
    }
    function backPage(){
        const key1 = crypto.randomUUID();
        localStorage.setItem("key1", key1);
        localStorage.setItem("account1", token3);
        location.href = "/game-sites/top/top0001/top0001?key1=" + key1;
    }
  </script>
</html>
