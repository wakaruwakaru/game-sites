<html>
  <head>
    <style type="text/css">
      body{
        user-select:none;
      }
      /* フローティングボタンの共通デザイン */
      .floating-btn{
        position: fixed;
        right: 20px;
        bottom: 20px;
        width: 58px;
        height: 58px;
        border-radius: 50%;
        background: #111;
        border: 2px solid #4da6ff;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 26px;
        color: #bcdfff;
        cursor: pointer;
        transition: 0.25s;
        box-shadow: 0 0 10px #3d8cff88;
      }
      /* ホバー時に光る */
      .floating-btn:hover{
        background: #4da6ff33;
        box-shadow: 0 0 16px #4da6ffcc;
      }
      /* クリック時に縮む */
      .floating-btn:active{
        transform: scale(0.9);
      }
      /* ボタン位置調整 */
      #reloadBtn{
        bottom: 90px; /* logout の上に配置 */
      }
      #logoutBtn{
        bottom: 20px;
      }
    </style>
  </head>
  <body>

    <input type="text" id="pass" placeholder="pass" />
    <button id="gen">Generate</button>
    <div id="log1"></div>
    <div id="log2"></div>
    <canvas id="myChart"></canvas>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
      const template1 =
        (
          "abcdefghijklmnopqrstuvwxyz" +
          "ABCDEFGHIJKLMNOPQRSTUVWXYZ" +
          "!#$%&()=~|{}[]@+;:*<>/\?_-"
        ).split("");

      document.getElementById('gen').addEventListener('click', async ()=>{
        const pass = document.getElementById('pass').value;
        run(pass);
      });

      let counter = 0;
      async function run(pass){
        let count1 = 0;
        let passworld;
        while(true){
          const expect1 = indexToString(count1, template1);
          const expect2 = await sha256Hex(expect1);
          document.getElementById("log1").innerHTML = expect1;
          document.getElementById("log2").innerHTML = expect2;
          if(pass == expect2){
            passworld = expect1;
            break;
          }
          count1++;
          counter++;
          await delay(1);
        }
        document.getElementById("log1").innerHTML = "見つかりました！！";
        document.getElementById("log2").innerHTML = passworld;
      }

      const data = [];
      const labels = [];    
      const chart = new Chart(document.getElementById("myChart"), {
        type: "line",
        data: {
          labels,
          datasets: [{
            label: "入力値",
            data,
            borderWidth: 2
          }]
        }
      });

      function addChart(value1) {
        const v = Number(value1);
        if (Number.isNaN(v)) return;
        const d = chart.data;
        d.labels.push(new Date().toLocaleTimeString());
        d.datasets[0].data.push(v);
        if(d.datasets[0].data.length > 30){
          d.labels.shift();
          d.datasets[0].data.shift();
        }
        chart.update("none");
      }

      function indexToString(index, chars){
        const base = chars.length;
        let result = "";
        do{
          result = chars[index % base] + result;
          index = Math.floor(index / base) - 1;
        }while(index >= 0);
        return result;
      }

      function delay(ms){
        return new Promise(resolve => setTimeout(resolve, ms));
      }

      async function sha256Hex(text){
        const enc = new TextEncoder();
        const data = enc.encode(text);
        const hashBuffer = await crypto.subtle.digest('SHA-256', data);
        const hashArray = Array.from(new Uint8Array(hashBuffer));
        return hashArray.map(b=>b.toString(16).padStart(2,'0')).join('');
      }

      setInterval(() => {
        addChart(counter);
        counter = 0;
      }, 1000);

      /*
      a-z:26 A-Z:26 !-\:26
      計78文字　200Hzの場合
    1 　　　　　　　　〇                    78p 0.39s
    2 　　　　　　　〇〇                 6,084p 30.4s
    3 　　　　　　〇〇〇               474,552p 39.5m
    4 　　　　　〇〇〇〇            37,015,056p 51.4h
    5 　　　　〇〇〇〇〇         2,887,174,368p 167d
    6　 　　〇〇〇〇〇〇       225,199,600,704p 35.7y
    7 　　〇〇〇〇〇〇〇    17,565,568,854,912p 2875y
    8 　〇〇〇〇〇〇〇〇 1,370,114,370,683,136p 217230.2y
      */
    </script>
    <div id="reloadBtn" class="floating-btn" onclick="reload()">↻</div>
    <div id="logoutBtn" class="floating-btn" onclick="backPage()">⇦</div>
  </body>
  <script>
    const urlParams = new URLSearchParams(location.search);
    const token1 = urlParams.get("key1");
    localStorage.setItem("requestPage1", "");
    const token3 = localStorage.getItem("account1");
    localStorage.setItem("account1", "");
    if((token1 !== localStorage.getItem("key1")) || (token3 != "wakaruwakaru")){
      localStorage.setItem("key1", "unauthorized");
      localStorage.setItem("requestPage1", "256-sha");
      location.href = "/game-sites/";
    }else{
      localStorage.setItem("key1", "");
    }

    function reload(){
      const key1 = crypto.randomUUID();
      localStorage.setItem("key1", key1);
      localStorage.setItem("account1", token3);
      location.href = "/game-sites/256-sha?key1=" + key1;
    }
    function backPage(){
      const key1 = crypto.randomUUID();
      localStorage.setItem("key1", key1);
      localStorage.setItem("account1", token3);
      location.href = "/game-sites/top/top0001/top0001?key1=" + key1;
    }
  </script>
</html>
