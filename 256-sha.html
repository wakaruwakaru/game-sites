<html>
  <head>
  </head>
  <body>

    <input type="text" id="pass" placeholder="pass" />
    <button id="gen">Generate</button>
    <div id="log1"></div>
    <div id="log2"></div>
    <canvas id="myChart"></canvas>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>

      const template1 =
        (
          "abcdefghijklmnopqrstuvwxyz" +
          "ABCDEFGHIJKLMNOPQRSTUVWXYZ" +
          "!#$%&()=~|{}[]@+;:*<>/\?_-"
        ).split("");


      document.getElementById('gen').addEventListener('click', async ()=>{
        const pass = document.getElementById('pass').value;
        run(pass);
      });

      let counter = 0;
      async function run(pass){
        let count1 = 0;
        let passworld;
        while(true){
          const expect1 = indexToString(count1, template1);
          const expect2 = await sha256Hex(expect1);
          document.getElementById("log1").innerHTML = expect1;
          document.getElementById("log2").innerHTML = expect2;
          if(pass == expect2){
            passworld = expect1;
            break;
          }
          count1++;
          counter++;
          await delay(1);
        }
        document.getElementById("log1").innerHTML = "見つかりました！！";
        document.getElementById("log2").innerHTML = passworld;
      }

      const data = [];
      const labels = [];    
      const chart = new Chart(document.getElementById("myChart"), {
        type: "line",
        data: {
          labels,
          datasets: [{
            label: "入力値",
            data,
            borderWidth: 2
          }]
        }
      });

      function addChart(value1) {
        const v = Number(value1);
        if (Number.isNaN(v)) return;
        const d = chart.data;
        d.labels.push(new Date().toLocaleTimeString());
        d.datasets[0].data.push(v);
        if(d.datasets[0].data.length > 30){
          d.labels.shift();
          d.datasets[0].data.shift();
        }
        chart.update("none");
      }

      function indexToString(index, chars){
        const base = chars.length;
        let result = "";
        do{
          result = chars[index % base] + result;
          index = Math.floor(index / base) - 1;
        }while(index >= 0);
        return result;
      }

      function delay(ms){
        return new Promise(resolve => setTimeout(resolve, ms));
      }

      async function sha256Hex(text){
        const enc = new TextEncoder();
        const data = enc.encode(text);
        const hashBuffer = await crypto.subtle.digest('SHA-256', data);
        const hashArray = Array.from(new Uint8Array(hashBuffer));
        return hashArray.map(b=>b.toString(16).padStart(2,'0')).join('');
      }

      setInterval(() => {
        addChart(counter);
        counter = 0;
      }, 1000);

      /*
      a-z:26 A-Z:26 !-\:26
      計78文字　200Hzの場合
    1 　　　　　　　　〇                    78p 0.39s
    2 　　　　　　　〇〇                 6,084p 30.4s
    3 　　　　　　〇〇〇               474,552p 39.5m
    4 　　　　　〇〇〇〇            37,015,056p 51.4h
    5 　　　　〇〇〇〇〇         2,887,174,368p 167d
    6　 　　〇〇〇〇〇〇       225,199,600,704p 35.7y
    7 　　〇〇〇〇〇〇〇    17,565,568,854,912p 2875y
    8 　〇〇〇〇〇〇〇〇 1,370,114,370,683,136p 217230.2y
      */
    </script>
  </body>
</html>
