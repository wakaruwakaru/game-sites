<html>
  <head>
    <meta charset="utf-8">
    <title>ホーム</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="shortcut icon" href="/game-sites/index/icon/icon1.png" >
    <link rel="stylesheet" href="/game-sites/top/css/main.css" />
  </head>
  <body>

    <h1>音ゲー</h1>
    <hr />
    <div class="link-list" id="linkList">
      <div class="neon-btn link-item" data-link="game/page0005/page0005-1">キーボードタイプ</div>
      <div class="neon-btn link-item" data-link="game/page0005/page0005-2">タッチタイプ</div>
    </div>
    <hr />
    <div id="reloadBtn" class="floating-btn" onclick="reload()">↻</div>
    <div id="logoutBtn" class="floating-btn" onclick="backPage()">⇦</div>
    <script>
        const urlParams = new URLSearchParams(location.search);
        const token1 = urlParams.get("key1");
        localStorage.setItem("requestPage1", "");
        const token3 = localStorage.getItem("account1");
        localStorage.setItem("account1", "");
        if((token1 !== localStorage.getItem("key1")) || (token3 == "") || (token3 == null)){
            localStorage.setItem("key1", "unauthorized");
            location.href = "/game-sites/";
        }else{
            localStorage.setItem("key1", "");
            setInterval(() => {
                sendToGAS(token3, "", "top");
            }, 5000);
        }

    /* ======== Google Apps Script Web App URL ======== */
    const WEB_APP_URL =
      "https://script.google.com/macros/s/AKfycbyU69VodYxnQJxMI4BhpCnVyvSlFcdM54XFnio5y8A02Uf_P__36zrWbpwih_Wc3szYHw/exec";
    /* ======== GASに送信する処理 ======== */
    async function sendToGAS(User, text, status){
      const payload = {
        user: User,
        message: text,
        status
      };
      try {
        await fetch(WEB_APP_URL, {
          method: "POST",
          mode: "no-cors",   // ← GAS が CORS 許可してないため必要
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });
      } catch (e) {
        console.error("送信エラー:", e);
      }
    }


    const linkList = document.getElementById("linkList");
    linkList.addEventListener("click", (e) => {
      const item = e.target.closest(".link-item");
      if (!item) return;
      const link = item.dataset.link;
      const key1 = crypto.randomUUID(); // 共通処理
      localStorage.setItem("key1", key1);
      localStorage.setItem("account1", token3);
      location.href = `/game-sites/${link}?key1=${key1}`;
    });


        function reload(){
            const key1 = crypto.randomUUID();
            localStorage.setItem("key1", key1);
            localStorage.setItem("account1", token3);
            location.href = "/game-sites/top/top0002/top0002?key1=" + key1;
        }
        function backPage(){
            const key1 = crypto.randomUUID();
            localStorage.setItem("key1", key1);
            localStorage.setItem("account1", token3);
            location.href = "/game-sites/top/top0001/top0001?key1=" + key1;
        }
    </script>
  </body>
</html>
